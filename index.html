<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>dice</title>
<style>
  /* å…¨ä½“ã®ãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºã‚’border-boxã«ã—ã¦ã‚ºãƒ¬ã‚’é˜²ã */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  /* bodyå…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* æ–‡å­—ãƒ•ã‚©ãƒ³ãƒˆ */
    background: linear-gradient(135deg, #FFE29F 0%, #FFA99F 100%); /* å¤ã®æœæ—¥ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã‚ªãƒ¬ãƒ³ã‚¸ç³»ã‚°ãƒ©ãƒ‡ */
    color: #5B3A00; /* æš–ã‹ã¿ã®ã‚ã‚‹æŸ”ã‚‰ã‹ã„ãƒ–ãƒ©ã‚¦ãƒ³ç³»ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ */
    margin: 0; /* ä½™ç™½ãªã— */
    min-height: 100vh; /* ç”»é¢å…¨ä½“ã®é«˜ã• */
    display: flex; /* ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ãƒœãƒƒã‚¯ã‚¹ã§ä¸­å¤®æƒãˆ */
    justify-content: center; /* æ¨ªæ–¹å‘ä¸­å¤®æƒãˆ */
    align-items: center; /* ç¸¦æ–¹å‘ä¸­å¤®æƒãˆ */
    padding: 1rem; /* å‘¨å›²ã«ä½™ç™½ */
  }

  /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
  main {
    background: #fff8e1; /* ã‚¯ãƒªãƒ¼ãƒ è‰²ã§å„ªã—ã„å°è±¡ */
    padding: 2rem 2.5rem; /* å†…å´ä½™ç™½ */
    border-radius: 16px; /* è§’ä¸¸ */
    box-shadow: 0 10px 30px rgba(255, 160, 160, 0.3); /* æŸ”ã‚‰ã‹ãªå½± */
    max-width: 400px; /* æœ€å¤§å¹… */
    width: 100%; /* å¹…ã¯è¦ªã«åˆã‚ã›ã‚‹ */
  }

  /* ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  h1 {
    text-align: center; /* ä¸­å¤®æƒãˆ */
    margin: 0 0 1rem 0; /* ä¸‹ãƒãƒ¼ã‚¸ãƒ³ */
    font-weight: 700; /* å¤ªå­— */
    color: #d35d00; /* æš–ã‹ã„ã‚ªãƒ¬ãƒ³ã‚¸è‰² */
  }

  /* ãƒ©ãƒ™ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  label {
    display: block; /* ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ åŒ– */
    margin-top: 1rem; /* ä¸Šãƒãƒ¼ã‚¸ãƒ³ */
    font-weight: 600; /* ã‚„ã‚„å¤ªå­— */
    color: #7f4a00; /* å°‘ã—æš—ã‚ã®èŒ¶è‰² */
  }

  /* æ•°å€¤å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  input[type=number] {
    width: 100%; /* æ¨ªå¹…ã„ã£ã±ã„ */
    padding: 0.5rem 0.7rem; /* å†…å´ä½™ç™½ */
    font-size: 1rem; /* æ–‡å­—ã‚µã‚¤ã‚º */
    border-radius: 8px; /* è§’ä¸¸ */
    border: 1.5px solid #d97400; /* ã‚ªãƒ¬ãƒ³ã‚¸ç³»ã®å¢ƒç•Œç·š */
    margin-top: 0.3rem; /* ä¸Šä½™ç™½ */
    transition: border-color 0.3s ease; /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®å¤‰åŒ–ã‚¢ãƒ‹ãƒ¡ */
  }
  /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  input[type=number]:focus {
    outline: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æ¶ˆã™ */
    border-color: #ffa94d; /* æ˜ã‚‹ã„ã‚ªãƒ¬ãƒ³ã‚¸ã«å¤‰æ›´ */
    box-shadow: 0 0 5px #ffa94d; /* å…‰å½© */
  }

  /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  button {
    margin-top: 1.8rem; /* ä¸Šä½™ç™½ */
    width: 100%; /* æ¨ªå¹…ã„ã£ã±ã„ */
    padding: 0.75rem; /* å†…å´ä½™ç™½ */
    font-size: 1.1rem; /* å°‘ã—å¤§ãã‚ */
    font-weight: 700; /* å¤ªå­— */
    border: none; /* å¢ƒç•Œç·šãªã— */
    border-radius: 12px; /* è§’ä¸¸ */
    background: linear-gradient(45deg, #ffb347, #ffcc33); /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
    color: #5b3a00; /* æ–‡å­—è‰² */
    cursor: pointer; /* ãƒ›ãƒãƒ¼æ™‚ã«ãƒã‚¤ãƒ³ã‚¿ãƒ¼è¡¨ç¤º */
    box-shadow: 0 4px 12px rgba(255, 204, 51, 0.6); /* ãƒœã‚¿ãƒ³ã®å½± */
    transition: background 0.3s ease; /* èƒŒæ™¯è‰²ã®ã‚¹ãƒ ãƒ¼ã‚ºå¤‰åŒ– */
  }
  /* ãƒ›ãƒãƒ¼æ™‚ã®ãƒœã‚¿ãƒ³è‰² */
  button:hover {
    background: linear-gradient(45deg, #ffcc33, #ffb347);
  }
  /* ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ç¸®å°ã‚¢ãƒ‹ãƒ¡ */
  button:active {
    transform: scale(0.98);
  }

  /* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
  #result {
    margin-top: 2rem; /* ä¸Šä½™ç™½ */
    padding: 1rem; /* å†…å´ä½™ç™½ */
    background: #fff3cd; /* å„ªã—ã„ã‚¤ã‚¨ãƒ­ãƒ¼èƒŒæ™¯ */
    border: 1px solid #ffecb5; /* è–„ã„é»„è‰²ã®å¢ƒç•Œç·š */
    border-radius: 12px; /* è§’ä¸¸ */
    font-size: 1.1rem; /* æ–‡å­—ã‚µã‚¤ã‚º */
    color: #5b3a00; /* ãƒ†ã‚­ã‚¹ãƒˆè‰² */
    min-height: 3rem; /* æœ€ä½é«˜ã• */
    white-space: pre-wrap; /* æ”¹è¡Œã‚’åæ˜  */
  }

  /* ã‚¹ãƒãƒ›ãªã©ç”»é¢å¹…480pxä»¥ä¸‹ã®æ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
  @media (max-width: 480px) {
    main {
      padding: 1.5rem 1.8rem; /* å†…å´ä½™ç™½ã‚’å°‘ã—å°ã•ã */
      max-width: 320px; /* æœ€å¤§å¹…ã‚’ç‹­ã */
    }
    button {
      font-size: 1rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºå°‘ã—ç¸®å° */
      padding: 0.6rem; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°å°‘ã—ç¸®å° */
    }
  }
</style>
</head>
<body>
  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main>
    <h1>da-ice ğŸ²</h1>

    <!-- é¢æ•°å…¥åŠ› -->
    <label for="sides">é¢æ•° (2ã€œ1000):</label>
    <input
      type="number"
      id="sides"
      name="sides"
      min="2"
      max="1000"
      value="6"
      aria-label="é¢æ•°ï¼ˆ2ã‹ã‚‰1000ï¼‰"
    />

    <!-- å€‹æ•°å…¥åŠ› -->
    <label for="count">å€‹æ•° (1ã€œ20):</label>
    <input
      type="number"
      id="count"
      name="count"
      min="1"
      max="20"
      value="1"
      aria-label="å€‹æ•°ï¼ˆ1ã‹ã‚‰20ï¼‰"
    />

    <!-- ã‚µã‚¤ã‚³ãƒ­æŒ¯ã‚‹ãƒœã‚¿ãƒ³ -->
    <button id="rollBtn" type="button">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹ï¼</button>

    <!-- çµæœè¡¨ç¤º -->
    <div id="result" role="region" aria-live="polite"></div>
  </main>

  <script>
    // ãƒœã‚¿ãƒ³ã¨çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã®DOMå–å¾—
    const rollBtn = document.getElementById('rollBtn');
    const resultDiv = document.getElementById('result');

    // APIå€™è£œURLãƒªã‚¹ãƒˆï¼ˆé †ã«è©¦ã™ï¼‰
    const apiCandidates = [
      "https://api.hamusata.f5.si/api/dice",
      "https://dice-api.hamusata.workers.dev/"
    ];

    /**
     * è¤‡æ•°ã®APIã‚’é †ã«è©¦ã—ã¦æœ€åˆã«æˆåŠŸã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™é–¢æ•°
     * @param {string[]} urls APIã®ãƒ™ãƒ¼ã‚¹URLé…åˆ—
     * @returns {Promise<Object>} APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
     */
    async function fetchFromApis(urls) {
      for (const url of urls) {
        try {
          // APIã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
          const res = await fetch(url);
          // HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹OKã§ãªã‘ã‚Œã°ä¾‹å¤–
          if (!res.ok) throw new Error("APIã‚¨ãƒ©ãƒ¼");
          // JSONãƒ‘ãƒ¼ã‚¹ã—ã¦è¿”ã™
          const data = await res.json();
          return data;
        } catch {
          // å¤±æ•—ã—ãŸã‚‰æ¬¡ã®APIã‚’è©¦ã™
          continue;
        }
      }
      // ã™ã¹ã¦ã®APIãŒå¤±æ•—ã—ãŸå ´åˆã¯ä¾‹å¤–ã‚’æŠ•ã’ã‚‹
      throw new Error("ã™ã¹ã¦ã®APIãŒå¿œç­”ã—ã¾ã›ã‚“ã§ã—ãŸ");
    }

    // ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
    rollBtn.addEventListener('click', async () => {
      // å…¥åŠ›å€¤ã‚’å–å¾—ã—æ•°å€¤å¤‰æ›
      const sides = Number(document.getElementById('sides').value);
      const count = Number(document.getElementById('count').value);

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼‰
      if (sides < 2 || sides > 1000 || count < 1 || count > 20) {
        resultDiv.textContent = 'é¢æ•°ã¯2ã€œ1000ã€å€‹æ•°ã¯1ã€œ20ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼';
        return;
      }

      // å‡¦ç†ä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
      resultDiv.textContent = 'æŒ¯ã£ã¦ã„ã¾ã™...';

      // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆ
      const query = `?sides=${sides}&count=${count}`;
      // API URLãƒªã‚¹ãƒˆã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜åŠ 
      const urlsWithParams = apiCandidates.map(base => base + query);

      try {
        // APIå‘¼ã³å‡ºã—
        const data = await fetchFromApis(urlsWithParams);
        // çµæœè¡¨ç¤ºã€‚APIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‹è©³ç´°ï¼ˆæŒ¯ã£ãŸæ•°å­—ã¨åˆè¨ˆï¼‰
        resultDiv.textContent = data.message + 
          `\nè©³ç´°: ${data.rolls?.join(', ') || ''} (åˆè¨ˆ: ${data.total || ''})`;
      } catch {
        // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„ï¼ˆç©ºæ¬„ï¼‰
        resultDiv.textContent = '';
      }
    });
  </script>
</body>
</html>
